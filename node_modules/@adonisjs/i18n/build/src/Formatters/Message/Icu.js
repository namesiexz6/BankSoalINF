"use strict";
/*
 * @adonisjs/i18n
 *
 * (c) Harminder Virk <virk@adonisjs.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.IcuFormatter = void 0;
/// <reference path="../../../adonis-typings/index.ts" />
const intl_formatter_1 = require("@poppinss/intl-formatter");
const intl_messageformat_1 = require("intl-messageformat");
/**
 * Formatters for ICU message. We need the memoized
 * version for performance
 */
const IcuMessageFormatters = {
    getNumberFormat: intl_formatter_1.formatters.number,
    getDateTimeFormat: intl_formatter_1.formatters.date,
    getPluralRules: intl_formatter_1.formatters.plural,
};
/**
 * ICU translations formatter
 */
class IcuFormatter {
    constructor() {
        /**
         * Formatter syntax name
         */
        this.name = 'icu';
    }
    static addFormat(type, key, options) {
        switch (type) {
            case 'number':
                this.customFormats.number = this.customFormats.number || {};
                this.customFormats.number[key] = options;
                break;
            case 'date':
                this.customFormats.date = this.customFormats.date || {};
                this.customFormats.date[key] = options;
                break;
            case 'time':
                this.customFormats.time = this.customFormats.time || {};
                this.customFormats.time[key] = options;
                break;
        }
    }
    /**
     * Formats an ICU message string
     */
    format(message, locale, data) {
        return new intl_messageformat_1.IntlMessageFormat(message, locale, this.constructor['customFormats'], {
            /**
             * Disabling type-checking here since https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat accepts "exceptZero" as the
             * "signSymbol" but TypeScript bundled definition doesn't have it
             */
            formatters: IcuMessageFormatters,
            ignoreTag: true,
        }).format(data || {});
    }
}
exports.IcuFormatter = IcuFormatter;
/**
 * Custom formats to be used inside the ICU messages
 */
IcuFormatter.customFormats = {};
